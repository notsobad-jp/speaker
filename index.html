<html>
<head>
  <meta charset="utf-8">
  <title>speaker</title>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.3/semantic.min.css">
</head>
<body>
  <div class="ui stackable three column centered grid">
    <div class="center aligned column">
      <div class="ui relaxed horizontal list">
        <div class="item">
          <span class="speaker" data-text="hello world" data-lang="en-US">&#x1F4E2</span>
        </div>
        <div class="item">
          <span class="speaker" data-text="이심전심" data-lang="ko-KR">&#x1F4E2</span>
        </div>
        <div class="item">
          <span class="speaker" data-text="こんにちは" data-lang="ja-JP">&#x1F4E2</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    window.onload = function () {
      alert("ready");
      if (!'SpeechSynthesisUtterance' in window) {
 　     alert("no speech synthesis");
        var speakers = document.querySelectorAll(".speaker");
        for(i=0 ; i<speakers.length ; i++){
          speakers[i].addEventListener("click", function(e){
    	    alert('お使いのブラウザは音声再生に対応していないようです。GoogleChromeでの利用をオススメします。');
          }, {once: true});
        }
        return;
      }
 　     alert("yes speech synthesis");
      
      var isSpeakerInitialized = false;

      if ('onvoiceschanged' in speechSynthesis) {
        alert("exists");
      }else {
        alert("not exists");
      }
      
      if ('onvoiceschanged' in speechSynthesis) {
        speechSynthesis.onvoiceschanged = function(){
          afterVoiceChanged();
        }
      }else {
          afterVoiceChanged();
      }
       

      
      function afterVoiceChanged() {
 　     alert("on voice changed");
        if(isSpeakerInitialized) { return; }
        isSpeakerInitialized = true;

        var systemVoices = speechSynthesis.getVoices();
 　     alert(systemVoices);
            for (var j = 0; j < systemVoices.length; j++) {
              alert(systemVoices[j].lang);
            }

        
        var speakers = document.querySelectorAll(".speaker");
        for(i=0 ; i<speakers.length ; i++){
          speakers[i].addEventListener("click", function(e){
            var synth = new SpeechSynthesisUtterance();
            synth.text = e.target.getAttribute("data-text");
            synth.lang = e.target.getAttribute("data-lang");

            for (var j = 0; j < systemVoices.length; j++) {
              if (systemVoices[j].lang == synth.lang){
                synth.voice = systemVoices[j];
              }
            }
            if(!synth.voice){ alert('対応言語がありません:'+synth.lang); }
            speechSynthesis.speak(synth);
          }, {once: true});
        }
      } 
      
      };
  </script>
</body>
</html>


