<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>Speaker.js</title>
  <meta name="description" content=""/>
  <meta name="keywords" content="speaker.js,speaker,音声,再生,ブラウザ,chrome,safari,firefox,iphone,android"/>

  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.3/semantic.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/balloon-css/0.2.4/balloon.min.css">
  <link href="https://fonts.googleapis.com/css?family=Lobster" rel="stylesheet">
  <style>
    .speaker {
      cursor: pointer;
    }
  </style>
</head>

<body style="background:url('img/bg.gif');">
  <div style="height:100vh;background-color:rgba(0,0,0,0.4);">
    <div class="ui fluid container" style="margin-left:0!important;margin-right:0!important;">
      <div class="ui center aligned padded basic segment" style="padding-top:100px">
        <!--<h1 class="ui huge icon inverted header" style="font-family:'Lobster', cursive; font-size:4rem;">-->
        <h1 class="ui huge icon inverted header" style="font-size:4rem;">
          <img class="ui centered small image" src="img/logo.png" style="transform: scale(-1, 1);" />
          <div class="content" style="line-height:6rem;">
            Speaker.js
          </div>
          <div class="ui sub inverted header">
            <span class="speaker" data-text="簡単コピペで、あなたのサイトがしゃべりだす" data-lang="ja-JP">
              簡単コピペで、あなたのサイトがしゃべりだす
            </span>
          </div>
        </h1>

        <div class="ui hidden divider"></div>
        <div>
          <a href="#howto">
            <button class="ui red right labeled large icon button">
              <i class="icon download"></i>
              Download for FREE
            </button>
          </a>
        </div>
        <br>

        <div class="ui hidden divider"></div>

        <div class="center aligned segment">
          <div class="ui horizontal list">
            <div class="item">
              <i class="speaker circular inverted orange large icon volume up" data-text="hello" data-lang="en-US"></i>
            </div>
            <div class="item">
              <i class="speaker circular inverted blue large icon volume up" data-text="こんにちは" data-lang="ja-JP"></i>
            </div>
            <div class="item">
              <i class="speaker circular inverted green large icon volume up" data-text="你好" data-lang="zh-CN"></i>
            </div>
            <div class="item">
              <i class="speaker circular inverted purple large icon volume up" data-text="안녕하세요" data-lang="ko-KR"></i>
            </div>
            <div class="item">
              <i class="speaker circular inverted pink large icon volume up" data-text="Buenas tardes" data-lang="es-ES"></i>
            </div>
            <div class="item">
              <i class="speaker circular inverted brown large icon volume up" data-text="Bonjour" data-lang="fr-FR"></i>
            </div>
            <div class="item">
              <i class="speaker circular inverted black large icon volume up" data-text="Guten tag" data-lang="de-DE"></i>
            </div>
          </div>
        </div>

        <div class="ui hidden divider"></div>
        <br>

        <div class="ui horizontal inverted small divided link list">
          <span class="item speaker" data-text="powered by NOT SO BAD" data-lang="en-GB">
            Copyright © Speaker.js by
            <a href="http://notosbad.jp" target="_blank">NOT SO BAD</a>
            2016 All Rights Reserved.
          </span>
        </div>
      </div>
    </div>
  </div>

  <script>
    window.onload = function () {
      if (typeof(speechSynthesis) == "undefined") {
        var speakers = document.querySelectorAll(".speaker");
        for(i=0 ; i<speakers.length ; i++){
          speakers[i].addEventListener("click", function(e){
            alert('お使いのブラウザは音声再生に対応していないようです。GoogleChromeでの利用をオススメします。');
          });
        }
        return;
      }

      var isSpeakerInitialized = false;

      if ('onvoiceschanged' in speechSynthesis) {
        speechSynthesis.onvoiceschanged = function(){
          setSpeaker();
        }
      }else {
        setSpeaker();
      }

      function setSpeaker() {
        if(isSpeakerInitialized) { return; }
        isSpeakerInitialized = true;

        var systemVoices = speechSynthesis.getVoices();

        var speakers = document.querySelectorAll(".speaker");
        for(i=0 ; i<speakers.length ; i++){
          var parent = speakers[i].parentNode;
          var span = document.createElement('span');
          span.setAttribute('data-balloon', speakers[i].getAttribute("data-text"));
          span.appendChild(speakers[i]);
          parent.appendChild(span);

          speakers[i].addEventListener("click", function(e){
            var synth = new SpeechSynthesisUtterance();
            synth.text = e.target.getAttribute("data-text");
            synth.lang = e.target.getAttribute("data-lang");

            for (var j = 0; j < systemVoices.length; j++) {
              if (systemVoices[j].lang == synth.lang){
                synth.voice = systemVoices[j];
              }
            }
            if(!synth.voice){
              alert('ごめんなさい、お使いのブラウザが対応していない言語のようです...');
              return;
            }
            speechSynthesis.speak(synth);
          });
        }
      }
    };
  </script>
</body>
</html>
